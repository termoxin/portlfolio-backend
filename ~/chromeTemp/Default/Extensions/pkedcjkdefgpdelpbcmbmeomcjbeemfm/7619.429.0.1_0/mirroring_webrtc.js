'use strict';var Kpa={TAB:0,Tj:1,An:2},Y$=function(a){Cb("MediaRouter.WebRtc.Start.Success",a,Kpa)};var Z$=function(a,c){pj.call(this,c);this.C=a;this.g=new Db;this.b=ry(c.id);this.w=new Db;this.D=!1;this.m=null;this.u=!1;this.o=this.h=null;Lpa(this);Mpa(this);this.b.sendMessage(new vj("GET_TURN_CREDENTIALS"))};q(Z$,pj);
Z$.prototype.start=function(a){var c=this;return this.g.b.then(function(b){if(b.b)return Promise.reject(new ti("Mirroring already started"));if(c.m)return Promise.reject(new ti("Session permanently stopped"));c.h=new sb("MediaRouter.WebRtc.Session.Launch");b.ia.addStream(a);b.start();return c.w.b})};
Z$.prototype.stop=function(){var a=this;this.w.reject(new ti("Session stop requested."));this.o&&(this.o.end(),this.o=null);if(this.m)return this.m;this.u=this.D=!1;this.h=null;return this.m=this.g.b.then(function(c){c.stop()}).then(function(){return a.b.Za()}).catch(function(c){a.b.Za();throw c;})};
var Lpa=function(a){a.b.onMessage=function(c){if(!c.type)throw Error("Message has no type.");switch(c.type){case "TURN_CREDENTIALS":a.g.resolve(new Aj(a.f.id,c.data.credentials));break;case "ANSWER":a.g.b.then(function(b){Ij(b,c.data)});break;case "KNOCK_ANSWER":a.u=!0;a.g.b.then(function(b){Ij(b,c.data)});break;case "STOP":a.w.reject(new ti("Stop signal received"));a.stop();break;default:throw new ti("Unknown message type: "+c.type);}}},Mpa=function(a){a.g.b.then(function(c){Ej(c,function(b){a.b.sendMessage(new vj("OFFER",
new xj(b,a.C,yj)))});Fj(c,function(b){b=wj(b);a.b.sendMessage(b)});Bj(c,function(){a.D=!0;a.b.sendMessage(new vj("SESSION_START_SUCCESS"));!a.u&&a.h&&a.h.end();a.h=null;a.o=new yb("MediaRouter.WebRtc.Session.Length");a.w.resolve(a)});Dj(c,function(){a.b.sendMessage(new vj("SESSION_END"))});Cj(c,function(b){a.D||a.w.reject(b);a.b.sendMessage(new vj("SESSION_FAILURE"))})})};var $$=function(){ej.call(this,"webrtc")};q($$,ej);h=$$.prototype;h.lh=function(a,c){return new Z$(a,c)};h.Qg=function(){Y$(0)};h.Mg=function(){Y$(1)};h.Kh=function(){Y$(2)};h.Ng=function(){Bb("MediaRouter.WebRtc.Session.End")};h.Og=function(a){Cb("MediaRouter.WebRtc.Start.Failure",a,si)};h.Pg=function(){Bb("MediaRouter.WebRtc.Stream.End")};var Npa=new $$;Vi("mr.mirror.webrtc.WebRtcService",Npa);
